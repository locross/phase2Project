{"ast":null,"code":"\"use strict\"; //see our the article at https://www.visualcrossing.com/resources/documentation/weather-api/how-to-add-weather-data-to-a-node-js-app-using-a-weather-api-and-javascript/\n\nconst http = require(\"http\");\n\nconst url = require(\"url\");\n\nconst https = require('https');\n\nconst API_KEY = 'YOUR_API_KEY';\nconst UNIT_GROUP = \"us\";\n\nconst retrieveWeatherData = function (location, start, end) {\n  var requestUrl = `https://weather.visualcrossing.com/VisualCrossingWebServices/rest/services/timeline/${encodeURIComponent(location)}`;\n  if (start) requestUrl += `/${start}`;\n  if (start && end) requestUrl += `/${end}`;\n  requestUrl += `?unitGroup=${UNIT_GROUP}&key=${API_KEY}`;\n  console.log(`Request to ${requestUrl}`);\n  return new Promise(function (resolve, reject) {\n    https.get(requestUrl, function (res) {\n      var statusCode = res.statusCode;\n      const contentType = res.headers['content-type'];\n      var error;\n\n      if (statusCode !== 200) {\n        error = `Request Failed. Status Code: ${statusCode}`;\n      } else if (!/^application\\/json/.test(contentType)) {\n        error = `Invalid content-type. Expected application/json but received ${contentType}`;\n        statusCode = 500;\n      }\n\n      res.setEncoding('utf8');\n      let rawData = '';\n      res.on('data', chunk => {\n        rawData += chunk;\n      });\n      res.on('end', () => {\n        try {\n          if (error) {\n            console.error(`Error: ${error}. Details: ${rawData}`);\n            reject(`Error: ${error}. Details: ${rawData}`);\n          } else {\n            resolve(JSON.parse(rawData));\n          }\n        } catch (e) {\n          console.error(`Unexpected error ${e.message}`);\n          reject(`Unexpected error ${e.message}`);\n        }\n      });\n    }).on('error', e => {\n      console.error(`Error 3 ${e}`);\n      ;\n      reject(`Communication error ${e}`);\n    });\n  });\n};\n\nconst buildWeatherTable = function (weatherData) {\n  if (!weatherData || !weatherData.days) {\n    return \"<h3>Unexpected weather data</h1>\";\n  }\n\n  var html = `<h1>Weather Data for ${weatherData.resolvedAddress}`;\n  html += `<table>`;\n  html += `<tr><th>Date</th><th>Max temp</th><th>Min temp</th><th>Precip</th><th>Wind</th><th>Wind direction</th></tr>`;\n  weatherData.days.forEach(function (day) {\n    html += `<tr><td>${day.datetime}</td><td>${day.tempmax}</td><td>${day.tempmin}</td><td>${day.precip}</td><td>${day.windspeed}</td><td>${day.winddir}</td></tr>`;\n\n    if (day.hours) {\n      day.hours.forEach(function (hour) {\n        html += `<tr><td>&nbsp;${hour.datetime}</td><td colspan=\"2\">${hour.temp}</td><td>${hour.precip}</td><td>${hour.windspeed}</td><td>${hour.winddir}</td></tr>`;\n      });\n    }\n  });\n  html += `</table>`;\n  return html;\n};\n\nhttp.createServer(function (request, response) {\n  const queryObject = url.parse(request.url, true).query;\n  response.writeHead(200, {\n    'Content-Type': 'text/html'\n  });\n\n  if (!queryObject.location) {\n    response.end(`<html><body>Please include a location query parameter</body></html>`);\n    return;\n  }\n\n  retrieveWeatherData(queryObject.location, queryObject.start, queryObject.end).then(function (data) {\n    response.end(`<html><body>${buildWeatherTable(data)}</body></html>`);\n  }).catch(function (data) {\n    response.end(`<html><body>${data}</body></html>`);\n  });\n}).listen(8081); // Console will print the message\n\nconsole.log('Server running at http://127.0.0.1:8081/');","map":{"version":3,"names":["http","require","url","https","API_KEY","UNIT_GROUP","retrieveWeatherData","location","start","end","requestUrl","encodeURIComponent","console","log","Promise","resolve","reject","get","res","statusCode","contentType","headers","error","test","setEncoding","rawData","on","chunk","JSON","parse","e","message","buildWeatherTable","weatherData","days","html","resolvedAddress","forEach","day","datetime","tempmax","tempmin","precip","windspeed","winddir","hours","hour","temp","createServer","request","response","queryObject","query","writeHead","then","data","catch","listen"],"sources":["/home/locr/SE_Work/phase2Project/src/api/weather.js"],"sourcesContent":["\"use strict\";\r\n\r\n//see our the article at https://www.visualcrossing.com/resources/documentation/weather-api/how-to-add-weather-data-to-a-node-js-app-using-a-weather-api-and-javascript/\r\nconst http = require(\"http\");\r\nconst url = require(\"url\");\r\nconst https = require('https');\r\n\r\n\r\nconst API_KEY = 'YOUR_API_KEY'; \r\nconst UNIT_GROUP=\"us\";\r\n\r\nconst retrieveWeatherData = function (location, start, end) { \r\n  \r\n    var requestUrl = `https://weather.visualcrossing.com/VisualCrossingWebServices/rest/services/timeline/${encodeURIComponent(location)}`;\r\n\tif (start) requestUrl+=`/${start}`;\r\n\tif (start && end) requestUrl+=`/${end}`;\r\n\t\r\n\trequestUrl+=`?unitGroup=${UNIT_GROUP}&key=${API_KEY}`; \r\n\tconsole.log(`Request to ${requestUrl}`); \r\n\t\r\n\treturn new Promise(function(resolve, reject) {\r\n\t\thttps.get(requestUrl, function (res) { \r\n\t\t  var statusCode= res.statusCode;\r\n\t\t  const contentType = res.headers['content-type'];\r\n\r\n\t\t  var error;\r\n\t\t  if (statusCode !== 200) {\r\n\t\t\terror = `Request Failed. Status Code: ${statusCode}`;\r\n\t\t  } else if (!/^application\\/json/.test(contentType)) {\r\n\t\t\terror = `Invalid content-type. Expected application/json but received ${contentType}`;\t\t  \r\n\t\t\tstatusCode=500;\r\n\t\t  }\r\n\t\t  \r\n\t\t  res.setEncoding('utf8');\r\n\t\t  let rawData = '';\r\n\t\t  res.on('data', (chunk) => { rawData += chunk; });\r\n\t\t  res.on('end', () => {\r\n\t\t\ttry {\r\n\r\n\t\t\t\tif (error) {\r\n\t\t\t\t\tconsole.error(`Error: ${error}. Details: ${rawData}`);\r\n\t\t\t\t\treject(`Error: ${error}. Details: ${rawData}`);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tresolve(JSON.parse(rawData));\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\r\n\t\t\t} catch (e) {\r\n\t\t\t  console.error(`Unexpected error ${e.message}`);\r\n\t\t\t  reject(`Unexpected error ${e.message}`);\r\n\t\t\t}\r\n\t\t  });\r\n\t\t}).on('error', (e) => {\r\n\t\t\tconsole.error(`Error 3 ${e}`);;\r\n\t\t\t reject(`Communication error ${e}`);\r\n\t\t});\r\n\t\r\n\t});\r\n} \r\nconst buildWeatherTable= function (weatherData) { \r\n\tif (!weatherData || !weatherData.days) {\r\n\t\treturn \"<h3>Unexpected weather data</h1>\";\r\n\t}\r\n\r\n\tvar html=`<h1>Weather Data for ${weatherData.resolvedAddress}`;\r\n\t\r\n\t\r\n\thtml+=`<table>`;\r\n\thtml+=`<tr><th>Date</th><th>Max temp</th><th>Min temp</th><th>Precip</th><th>Wind</th><th>Wind direction</th></tr>`;\r\n\tweatherData.days.forEach(function(day) {\r\n\t\thtml+=`<tr><td>${day.datetime}</td><td>${day.tempmax}</td><td>${day.tempmin}</td><td>${day.precip}</td><td>${day.windspeed}</td><td>${day.winddir}</td></tr>`;\r\n\t\tif (day.hours) {\r\n\t\t\tday.hours.forEach(function(hour) {\r\n\t\t\t\thtml+=`<tr><td>&nbsp;${hour.datetime}</td><td colspan=\"2\">${hour.temp}</td><td>${hour.precip}</td><td>${hour.windspeed}</td><td>${hour.winddir}</td></tr>`;\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\thtml+=`</table>`;\r\n\treturn html;\r\n}\r\nhttp.createServer(function (request, response) {\r\n\r\n\t\r\n   const queryObject = url.parse(request.url,true).query;\r\n   response.writeHead(200, {'Content-Type': 'text/html'});\r\n   if (!queryObject.location) {\r\n\t\tresponse.end(`<html><body>Please include a location query parameter</body></html>`);\r\n\t\treturn;\r\n   }\r\n   \r\n   retrieveWeatherData(queryObject.location, queryObject.start,queryObject.end).then(function(data) {\r\n\t\t\r\n\t\tresponse.end(`<html><body>${buildWeatherTable(data)}</body></html>`);\r\n   \r\n   }).catch(function(data) {\r\n\t\tresponse.end(`<html><body>${data}</body></html>`);\r\n   });\r\n\r\n}).listen(8081);\r\n\r\n// Console will print the message\r\nconsole.log('Server running at http://127.0.0.1:8081/');"],"mappings":"AAAA,a,CAEA;;AACA,MAAMA,IAAI,GAAGC,OAAO,CAAC,MAAD,CAApB;;AACA,MAAMC,GAAG,GAAGD,OAAO,CAAC,KAAD,CAAnB;;AACA,MAAME,KAAK,GAAGF,OAAO,CAAC,OAAD,CAArB;;AAGA,MAAMG,OAAO,GAAG,cAAhB;AACA,MAAMC,UAAU,GAAC,IAAjB;;AAEA,MAAMC,mBAAmB,GAAG,UAAUC,QAAV,EAAoBC,KAApB,EAA2BC,GAA3B,EAAgC;EAExD,IAAIC,UAAU,GAAI,uFAAsFC,kBAAkB,CAACJ,QAAD,CAAW,EAArI;EACH,IAAIC,KAAJ,EAAWE,UAAU,IAAG,IAAGF,KAAM,EAAtB;EACX,IAAIA,KAAK,IAAIC,GAAb,EAAkBC,UAAU,IAAG,IAAGD,GAAI,EAApB;EAElBC,UAAU,IAAG,cAAaL,UAAW,QAAOD,OAAQ,EAApD;EACAQ,OAAO,CAACC,GAAR,CAAa,cAAaH,UAAW,EAArC;EAEA,OAAO,IAAII,OAAJ,CAAY,UAASC,OAAT,EAAkBC,MAAlB,EAA0B;IAC5Cb,KAAK,CAACc,GAAN,CAAUP,UAAV,EAAsB,UAAUQ,GAAV,EAAe;MACnC,IAAIC,UAAU,GAAED,GAAG,CAACC,UAApB;MACA,MAAMC,WAAW,GAAGF,GAAG,CAACG,OAAJ,CAAY,cAAZ,CAApB;MAEA,IAAIC,KAAJ;;MACA,IAAIH,UAAU,KAAK,GAAnB,EAAwB;QACzBG,KAAK,GAAI,gCAA+BH,UAAW,EAAnD;MACE,CAFD,MAEO,IAAI,CAAC,qBAAqBI,IAArB,CAA0BH,WAA1B,CAAL,EAA6C;QACrDE,KAAK,GAAI,gEAA+DF,WAAY,EAApF;QACAD,UAAU,GAAC,GAAX;MACE;;MAEDD,GAAG,CAACM,WAAJ,CAAgB,MAAhB;MACA,IAAIC,OAAO,GAAG,EAAd;MACAP,GAAG,CAACQ,EAAJ,CAAO,MAAP,EAAgBC,KAAD,IAAW;QAAEF,OAAO,IAAIE,KAAX;MAAmB,CAA/C;MACAT,GAAG,CAACQ,EAAJ,CAAO,KAAP,EAAc,MAAM;QACrB,IAAI;UAEH,IAAIJ,KAAJ,EAAW;YACVV,OAAO,CAACU,KAAR,CAAe,UAASA,KAAM,cAAaG,OAAQ,EAAnD;YACAT,MAAM,CAAE,UAASM,KAAM,cAAaG,OAAQ,EAAtC,CAAN;UACA,CAHD,MAGO;YACNV,OAAO,CAACa,IAAI,CAACC,KAAL,CAAWJ,OAAX,CAAD,CAAP;UACA;QAID,CAXD,CAWE,OAAOK,CAAP,EAAU;UACVlB,OAAO,CAACU,KAAR,CAAe,oBAAmBQ,CAAC,CAACC,OAAQ,EAA5C;UACAf,MAAM,CAAE,oBAAmBc,CAAC,CAACC,OAAQ,EAA/B,CAAN;QACD;MACC,CAhBD;IAiBD,CAhCD,EAgCGL,EAhCH,CAgCM,OAhCN,EAgCgBI,CAAD,IAAO;MACrBlB,OAAO,CAACU,KAAR,CAAe,WAAUQ,CAAE,EAA3B;MAA8B;MAC7Bd,MAAM,CAAE,uBAAsBc,CAAE,EAA1B,CAAN;IACD,CAnCD;EAqCA,CAtCM,CAAP;AAuCA,CAhDD;;AAiDA,MAAME,iBAAiB,GAAE,UAAUC,WAAV,EAAuB;EAC/C,IAAI,CAACA,WAAD,IAAgB,CAACA,WAAW,CAACC,IAAjC,EAAuC;IACtC,OAAO,kCAAP;EACA;;EAED,IAAIC,IAAI,GAAE,wBAAuBF,WAAW,CAACG,eAAgB,EAA7D;EAGAD,IAAI,IAAG,SAAP;EACAA,IAAI,IAAG,6GAAP;EACAF,WAAW,CAACC,IAAZ,CAAiBG,OAAjB,CAAyB,UAASC,GAAT,EAAc;IACtCH,IAAI,IAAG,WAAUG,GAAG,CAACC,QAAS,YAAWD,GAAG,CAACE,OAAQ,YAAWF,GAAG,CAACG,OAAQ,YAAWH,GAAG,CAACI,MAAO,YAAWJ,GAAG,CAACK,SAAU,YAAWL,GAAG,CAACM,OAAQ,YAAlJ;;IACA,IAAIN,GAAG,CAACO,KAAR,EAAe;MACdP,GAAG,CAACO,KAAJ,CAAUR,OAAV,CAAkB,UAASS,IAAT,EAAe;QAChCX,IAAI,IAAG,iBAAgBW,IAAI,CAACP,QAAS,wBAAuBO,IAAI,CAACC,IAAK,YAAWD,IAAI,CAACJ,MAAO,YAAWI,IAAI,CAACH,SAAU,YAAWG,IAAI,CAACF,OAAQ,YAA/I;MACA,CAFD;IAGA;EACD,CAPD;EAQAT,IAAI,IAAG,UAAP;EACA,OAAOA,IAAP;AACA,CApBD;;AAqBAnC,IAAI,CAACgD,YAAL,CAAkB,UAAUC,OAAV,EAAmBC,QAAnB,EAA6B;EAG5C,MAAMC,WAAW,GAAGjD,GAAG,CAAC2B,KAAJ,CAAUoB,OAAO,CAAC/C,GAAlB,EAAsB,IAAtB,EAA4BkD,KAAhD;EACAF,QAAQ,CAACG,SAAT,CAAmB,GAAnB,EAAwB;IAAC,gBAAgB;EAAjB,CAAxB;;EACA,IAAI,CAACF,WAAW,CAAC5C,QAAjB,EAA2B;IAC5B2C,QAAQ,CAACzC,GAAT,CAAc,qEAAd;IACA;EACE;;EAEDH,mBAAmB,CAAC6C,WAAW,CAAC5C,QAAb,EAAuB4C,WAAW,CAAC3C,KAAnC,EAAyC2C,WAAW,CAAC1C,GAArD,CAAnB,CAA6E6C,IAA7E,CAAkF,UAASC,IAAT,EAAe;IAElGL,QAAQ,CAACzC,GAAT,CAAc,eAAcuB,iBAAiB,CAACuB,IAAD,CAAO,gBAApD;EAEE,CAJD,EAIGC,KAJH,CAIS,UAASD,IAAT,EAAe;IACzBL,QAAQ,CAACzC,GAAT,CAAc,eAAc8C,IAAK,gBAAjC;EACE,CAND;AAQF,CAlBD,EAkBGE,MAlBH,CAkBU,IAlBV,E,CAoBA;;AACA7C,OAAO,CAACC,GAAR,CAAY,0CAAZ"},"metadata":{},"sourceType":"module"}